(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{5817:function(e,t,r){Promise.resolve().then(r.bind(r,5882))},5882:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return i}});var o=r(7437),n=r(2265),a=r(4033),s=r(7658);function i(){let{user:e,profile:t,loading:r}=(0,s.useAuth)(),i=(0,a.useRouter)(),[l,u]=(0,n.useState)(!1);return((0,n.useEffect)(()=>{u(!0)},[]),(0,n.useEffect)(()=>{!r&&l&&(e?"vendor"===e.role?i.push("/vendor/dashboard"):i.push("/customer/dashboard"):i.push("/login"))},[e,r,i,l]),r||!l)?(0,o.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-gray-50 to-white",children:(0,o.jsxs)("div",{className:"text-center",children:[(0,o.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-gray-600 mx-auto"}),(0,o.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading..."})]})}):null}},7658:function(e,t,r){"use strict";r.r(t),r.d(t,{AuthProvider:function(){return f},useAuth:function(){return m}});var o=r(7437),n=r(2265),a=r(6763);async function s(e){let t=new TextEncoder,r=t.encode(e),o=await crypto.subtle.digest("SHA-256",r);return Array.from(new Uint8Array(o)).map(e=>e.toString(16).padStart(2,"0")).join("")}async function i(e){let t=await s(e.password),{data:r,error:o}=await a.O.from("auth_users").insert({mobile:e.mobile,email:e.email,password_hash:t,role:e.role,is_active:!0}).select().single();if(o)throw Error(o.message);if("vendor"===e.role){let{data:t,error:o}=await a.O.from("vendors").insert({id:r.id,shop_name:e.shop_name||"New Shop",category:e.category||"General",description:e.description,business_type:e.business_type,location_lat:e.location_lat,location_lng:e.location_lng,location_address:e.location_address,is_online:!1,rating:0,total_orders:0,total_sales:0,active_customers:0}).select().single();if(o)throw Error(o.message);let n=c(r);return{user:r,profile:t,token:n}}{let{data:t,error:o}=await a.O.from("customers").insert({id:r.id,name:e.name||"New Customer",saved_address:e.location_address,location_lat:e.location_lat,location_lng:e.location_lng,language_preference:"en"}).select().single();if(o)throw Error(o.message);let n=c(r);return{user:r,profile:t,token:n}}}async function l(e,t){let r;let o=await s(t),{data:n,error:i}=await a.O.from("auth_users").select("*").eq("mobile",e).eq("password_hash",o).eq("is_active",!0).maybeSingle();if(i||!n)throw Error("Invalid credentials");if("vendor"===n.role){let{data:e,error:t}=await a.O.from("vendors").select("*").eq("id",n.id).single();if(t)throw Error(t.message);r=e}else{let{data:e,error:t}=await a.O.from("customers").select("*").eq("id",n.id).single();if(t)throw Error(t.message);r=e}let l=c(n);return{user:n,profile:r,token:l}}async function u(e){let t;let{data:r,error:o}=await a.O.from("auth_users").select("*").eq("id",e).eq("is_active",!0).maybeSingle();if(o||!r)return null;if("vendor"===r.role){let{data:e,error:o}=await a.O.from("vendors").select("*").eq("id",r.id).single();if(o)return null;t=e}else{let{data:e,error:o}=await a.O.from("customers").select("*").eq("id",r.id).single();if(o)return null;t=e}return{user:r,profile:t}}function c(e){return btoa(JSON.stringify({id:e.id,mobile:e.mobile,role:e.role,exp:Date.now()+6048e5}))}let d=(0,n.createContext)(void 0);function f(e){let{children:t}=e,[r,a]=(0,n.useState)(null),[s,c]=(0,n.useState)(null),[f,m]=(0,n.useState)(null),[h,g]=(0,n.useState)(!0);(0,n.useEffect)(()=>{let e=localStorage.getItem("auth_token");if(e){let t=function(e){try{return JSON.parse(atob(e))}catch(e){return null}}(e);t&&t.exp>Date.now()?(m(e),u(t.id).then(e=>{e&&(a(e.user),c(e.profile)),g(!1)}).catch(()=>{localStorage.removeItem("auth_token"),g(!1)})):(localStorage.removeItem("auth_token"),g(!1))}else g(!1)},[]);let _=async(e,t)=>{let r=await l(e,t);a(r.user),c(r.profile),m(r.token),localStorage.setItem("auth_token",r.token)},p=async e=>{let t=await i(e);a(t.user),c(t.profile),m(t.token),localStorage.setItem("auth_token",t.token)};return(0,o.jsx)(d.Provider,{value:{user:r,profile:s,token:f,loading:h,signIn:_,signUp:p,signOut:()=>{a(null),c(null),m(null),localStorage.removeItem("auth_token")}},children:t})}function m(){let e=(0,n.useContext)(d);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},6763:function(e,t,r){"use strict";r.d(t,{O:function(){return n}});var o=r(5257);let n=(0,o.eI)("https://zcgfztlebsezqqhtkrlh.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpjZ2Z6dGxlYnNlenFxaHRrcmxoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjEyMzExNzksImV4cCI6MjA3NjgwNzE3OX0.xTfJjhP4oaQsliJKTQHMwM3SZkvcJCgzYsQ1pcN9Om8")},4033:function(e,t,r){e.exports=r(290)}},function(e){e.O(0,[849,971,864,744],function(){return e(e.s=5817)}),_N_E=e.O()}]);